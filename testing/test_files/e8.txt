CREATE OR REPLACE PACKAGE BODY TEST_INGREDIENT_PKG AS
  PROCEDURE NEW( PNAME IN TEST_INGREDIENT.NAME%TYPE
                         , PBRAND IN TEST_INGREDIENT.BRAND%TYPE
                         , PCATG IN TEST_INGREDIENT.CATEGORY%TYPE
                         , PSERV_SIZE IN TEST_INGREDIENT.SERVING_SIZE%TYPE
                         , PSERV_UNIT IN TEST_INGREDIENT.SERVING_UNIT%TYPE
                         , PALT_SERV_SIZE IN TEST_INGREDIENT.ALT_SERVING_SIZE%TYPE
                         , PALT_SERV_UNIT IN TEST_INGREDIENT.ALT_SERVING_UNIT%TYPE
                         , PCAL IN TEST_INGREDIENT.CALORIES%TYPE
                         , PFAT IN TEST_INGREDIENT.FAT%TYPE
                         , PCARB IN TEST_INGREDIENT.CARBS%TYPE
                         , PPROT IN TEST_INGREDIENT.PROTEIN%TYPE
                         , PID IN TEST_INGREDIENT.ID%TYPE DEFAULT SEQ_TEST_INGREDIENT_ID.NEXTVAL
                         )
  IS
  BEGIN
    INSERT INTO TEST_INGREDIENT(ID, NAME, BRAND, CATEGORY, SERVING_UNIT, SERVING_SIZE, ALT_SERVING_UNIT, ALT_SERVING_SIZE, CALORIES, FAT, CARBS, PROTEIN)
    VALUES(PID, PNAME, PBRAND, PCATG, PSERV_UNIT, PSERV_SIZE, PALT_SERV_UNIT, PALT_SERV_SIZE, PCAL, PFAT, PCARB, PPROT);
    COMMIT;
    
    EXCEPTION
      WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
  END NEW;
  
  PROCEDURE GET(PCURSOR OUT SYS_REFCURSOR)
  IS
  BEGIN
    OPEN PCURSOR FOR
      SELECT *
      FROM TEST_INGREDIENT
      ORDER BY ID;
  END GET;
  
  PROCEDURE GET(PID IN TEST_INGREDIENT.ID%TYPE, PCURSOR OUT SYS_REFCURSOR)
  IS
  BEGIN
    OPEN PCURSOR FOR
      SELECT *
      FROM TEST_INGREDIENT
      WHERE ID=PID;
  END GET;
  
  PROCEDURE GET(PNAME IN TEST_INGREDIENT.NAME%TYPE, PCURSOR OUT SYS_REFCURSOR)
  IS
  BEGIN
    OPEN PCURSOR FOR
      SELECT *
      FROM TEST_INGREDIENT
      WHERE NAME=PNAME;
  END GET;
  
  PROCEDURE FILTER( PCATEGORY IN VARCHAR2
                  , PBRAND IN VARCHAR2
                  , PCURSOR OUT SYS_REFCURSOR
                  )
  IS
  BEGIN
    IF UPPER(PCATEGORY) != 'ALL' AND UPPER(PBRAND) != 'ALL' THEN
      OPEN PCURSOR FOR
        SELECT * FROM TEST_INGREDIENT WHERE UPPER(CATEGORY)=UPPER(PCATEGORY) AND UPPER(BRAND)=UPPER(PBRAND);
    ELSIF UPPER(PCATEGORY) != 'ALL' THEN
      OPEN PCURSOR FOR
        SELECT * FROM TEST_INGREDIENT WHERE UPPER(CATEGORY)=UPPER(PCATEGORY);
    ELSIF UPPER(PBRAND) != 'ALL' THEN
      OPEN PCURSOR FOR
        SELECT * FROM TEST_INGREDIENT WHERE UPPER(BRAND)=UPPER(PBRAND);
    ELSE
      OPEN PCURSOR FOR
        SELECT * FROM TEST_INGREDIENT;
    END IF;
  END FILTER;
  
END TEST_INGREDIENT_PKG;